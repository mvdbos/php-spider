#!/usr/bin/env bash
#
# Pre-commit hook for PHP-Spider
# Runs fast validation checks before allowing commit
#
# To install: cp .githooks/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit
# To bypass: git commit --no-verify
#

set -e

echo "üîç Running pre-commit validation..."
echo ""

# Check if vendor directory exists
if [ ! -d "vendor" ]; then
    echo "‚ùå Composer dependencies not installed. Run: composer install"
    exit 1
fi

# Run PHPUnit tests (fast feedback)
echo "Running tests..."
if ! ./vendor/bin/phpunit --no-coverage 2>&1 | tail -5; then
    echo ""
    echo "‚ùå Tests failed. Fix issues before committing."
    echo "   Tip: Run './vendor/bin/phpunit' to see full output"
    exit 1
fi

echo ""
echo "‚úÖ Pre-commit checks passed!"
echo ""
echo "‚ö†Ô∏è  REMINDER: Before creating/updating a PR, run:"
echo "   ./bin/check"
echo ""
echo "   This runs the full CI validation (static analysis + coverage)"
echo ""
